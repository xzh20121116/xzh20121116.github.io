<html>

<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>
    大厂面试必考：线程池的核心参数、核心流程、5大种类与应用场景 | 温故知新
</title>
<link rel="shortcut icon" href="https://xzh20121116.github.io/favicon.ico?v=1587890922895">
<!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous"> -->
<link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://xzh20121116.github.io/styles/main.css">
<!-- js -->
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script src="https://xzh20121116.github.io/media/js/jquery.sticky-sidebar.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>


    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-164265712-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'UA-164265712-1');
    </script>
    
        
            
                <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
                <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
                

                    
                            
</head>

<body>
    <div class="main">
        <div class="header">
    <div class="nav">
        <div class="logo">
            <a href="https://xzh20121116.github.io">
                <img class="avatar" src="https://xzh20121116.github.io/images/avatar.png?v=1587890922895" alt="">
            </a>
            <div class="site-title">
                <h1>
                    温故知新
                </h1>
            </div>
        </div>
        <span class="menu-btn fa fa-align-justify"></span>
        <div class="menu-container">
            <ul>
                
                    
                            <li>
                                <a href="/" class="menu">
                                    首页
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/archives" class="menu">
                                    归档
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/tags" class="menu">
                                    标签
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/post/about" class="menu">
                                    关于
                                </a>
                            </li>
                            
                                
            </ul>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        $(".menu-btn").click(function() {
            $(".menu-container").slideToggle();
        });
        $(window).resize(function() {

            if (window.matchMedia('(min-width: 960px)').matches) {
                $(".menu-container").css('display', 'block')
            } else {
                $(".menu-container").css('display', 'none')
            }

        });
    });
</script>

            <div id="main-content" class="post-detail main-container">
                <!-- left -->
                <div id="content" class="main-container-left">
                    <article class="post i-card">
                        <h2 class="post-title">
                            大厂面试必考：线程池的核心参数、核心流程、5大种类与应用场景
                        </h2>
                        <div class="post-info">
                            <time class="post-time">2020-04-26</time>
                            
                                <a href="https://xzh20121116.github.io/tag/VadQwd1qw/" class="post-tag i-tag
                            i-tag-other_2">
                            #java
                        </a>
                                
                                <a href="https://xzh20121116.github.io/tag/9tvO-JXYPa/" class="post-tag i-tag
                            i-tag-warning">
                            #线程
                        </a>
                                
                        </div>
                        
                                <div class="post-content">
                                    <p>大厂面试必考：线程池的核心参数、核心流程、5大种类与应用场景</p>
<!-- more -->
<h1 id="线程池的创建">线程池的创建</h1>
<p>juc包下的ThreadPoolExecutor，有序多重载的构造方法，指定不同的构造参数，创建不同类型的线程池。</p>
<pre><code class="language-java">ThreadPoolExecutor(int corePoolSize,
                              int maximumPoolSize,
                              long keepAliveTime,
                              TimeUnit unit,
                              BlockingQueue&lt;Runnable&gt; workQueue,
                              ThreadFactory threadFactory,
                              RejectedExecutionHandler handler)

</code></pre>
<h1 id="核心参数">核心参数</h1>
<h2 id="corepoolsize">corePoolSize</h2>
<p>核心线程数线程池的大小</p>
<h2 id="maximumpoolsize"><strong>maximumPoolSize</strong></h2>
<p>线程池允许创建的最大线程数</p>
<h2 id="keepalivetime"><strong>keepAliveTime</strong></h2>
<p>非核心线程的空闲存活时间，一个线程的空闲时间达到这个值，则会终止</p>
<h2 id="timeunit">TimeUnit</h2>
<p><strong>keepAliveTime</strong>的时间单位</p>
<blockquote>
<p>有7种取值：天、小时、分钟、秒、毫秒、微妙、纳秒</p>
</blockquote>
<h2 id="workqueue">workQueue</h2>
<p>阻塞队列，当核心线程都被占用时，新来的线程会进入阻塞队列等待执行，如果阻塞队列满了， 会创建工作线程(不超过最大线程数)</p>
<h2 id="threadfactory">threadFactory</h2>
<p>表示线程工厂。用来生产一组相同任务的线程，线程池的命名是通过这个factory增加组名前缀来实现的。在虚拟机栈分析时，就可以知道线程任务是由哪个线程工厂生产的</p>
<h2 id="handler">handler</h2>
<p>拒绝策略：当提交任务超过最大线程数时，执行拒绝策略</p>
<ol>
<li><code>AbortPolicy</code>（默认）：丢弃任务并抛出异常</li>
<li><code>DiscardPolicy</code>：丢弃任务，不抛出异常</li>
<li><code>DiscardOldestPolicy</code>：抛弃队列中等待最久的任务，然后把当前任务加入队列</li>
<li><code>callerRunsPolicy</code>：调用人的run方法，绕过线程池直接执行</li>
</ol>
<h1 id="核心流程">核心流程</h1>
<figure data-type="image" tabindex="1"><img src="https://picgo-xzh.oss-cn-beijing.aliyuncs.com/picgo20200426160957.png" alt="image-20200426160957865" loading="lazy"></figure>
<h1 id="关闭">关闭</h1>
<p>关闭线程池，有两种方法，可以通过<code>shutdown</code>和<code>shutdownNow</code>这两个方法，原理都是遍历线程池中的所有线程，依次中断。</p>
<p>不同点：</p>
<p><code>shutdown</code></p>
<blockquote>
<p>只是将线程池的状态设置为<code>SHUTDOWN</code>状态，然后中断所有没有正在执行任务的线程</p>
</blockquote>
<p><code>shutdownNow</code></p>
<blockquote>
<p>首先将线程池的状态设置为<code>STOP</code>，然后尝试停止所有正在执行和未执行任务的线程，并返回等待执行任务的列表</p>
</blockquote>
<h1 id="五种类型-区别-适用场景">五种类型、区别、适用场景</h1>
<h2 id="newcachedthreadpool">newCachedThreadPool：</h2>
<ul>
<li>底层：返回ThreadPoolExecutor实例，corePoolSize为0；maximumPoolSize为Integer.MAX_VALUE；keepAliveTime为60L；unit为TimeUnit.SECONDS；workQueue为SynchronousQueue(<code>同步队列</code>)</li>
<li>通俗：当有新任务到来，则插入到SynchronousQueue中，由于SynchronousQueue是同步队列，因此会在池中寻找可用线程来执行，若有可以线程则执行，若没有可用线程则创建一个线程来执行该任务；若池中线程空闲时间超过指定大小，则该线程会被销毁。</li>
<li>适用：执行很多短期异步的小程序或者负载较轻的服务器</li>
</ul>
<h2 id="newfixedthreadpool">newFixedThreadPool：</h2>
<ul>
<li>底层：返回ThreadPoolExecutor实例，接收参数为所设定线程数量nThread，corePoolSize为nThread，maximumPoolSize为nThread；keepAliveTime为0L(不限时)；unit为：TimeUnit.MILLISECONDS；WorkQueue为：new LinkedBlockingQueue<Runnable>() <code>无阻塞队列</code></li>
<li>通俗：创建可容纳固定数量线程的池子，每隔线程的存活时间是无限的，当池子满了就不在添加线程了；如果池中的所有线程均在繁忙状态，对于新任务会进入阻塞队列中(无界的阻塞队列·)</li>
<li>适用：执行长期的任务，性能好很多</li>
</ul>
<h2 id="newsinglethreadexecutor">newSingleThreadExecutor:</h2>
<ul>
<li>底层：FinalizableDelegatedExecutorService包装的ThreadPoolExecutor实例，corePoolSize为1；maximumPoolSize为1；keepAliveTime为0L；unit为：TimeUnit.MILLISECONDS；workQueue为：new LinkedBlockingQueue<Runnable>() <code>无界阻塞队列</code></li>
<li>通俗：创建只有一个线程的线程池，且线程的存活时间是无限的；当该线程正繁忙时，对于新任务会进入阻塞队列中(无界的阻塞队列)</li>
<li>适用：一个任务一个任务执行的场景，<strong>同步执行任务的场景</strong></li>
</ul>
<h2 id="newscheduledthreadpool">NewScheduledThreadPool:</h2>
<ul>
<li>底层：创建ScheduledThreadPoolExecutor实例，corePoolSize为传递来的参数，maximumPoolSize为Integer.MAX_VALUE；keepAliveTime为0；unit为：TimeUnit.NANOSECONDS；workQueue为：new DelayedWorkQueue() 一个按超时时间升序排序的队列</li>
<li>通俗：创建一个固定大小的线程池，线程池内线程存活时间无限制，线程池可以支持定时及周期性任务执行，如果所有线程均处于繁忙状态，对于新任务会进入DelayedWorkQueue队列中，这是一种按照超时时间排序的队列结构</li>
<li>适用：<strong>周期性执行任务的场景</strong></li>
</ul>

                                </div>
                    </article>
                    <!--  -->
                    
                        <div class="next-post">
                            <div class="next">下一篇</div>
                            <a href="https://xzh20121116.github.io/post/VPO1pZnCC/">
                                <h3 class="post-title">
                                    大厂面试必考：聊聊java内存模型、volatile的实现原理
                                </h3>
                            </a>
                        </div>
                        
                            <div id="disqus_thread"></div>
                            <div id="gitalk-container"></div>
                </div>
                <!-- middle -->
                <div class="main-container-middle"></div>
                <!-- right -->
                <div id="sidebar" class="main-container-right">
                    
                        <!-- toc -->
                        
    <div class="toc-card i-card ">
        <div class="toc-title i-card-title">目录</div>
        <div class="toc-content">
            <ul class="markdownIt-TOC">
<li><a href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%88%9B%E5%BB%BA">线程池的创建</a></li>
<li><a href="#%E6%A0%B8%E5%BF%83%E5%8F%82%E6%95%B0">核心参数</a>
<ul>
<li><a href="#corepoolsize">corePoolSize</a></li>
<li><a href="#maximumpoolsize"><strong>maximumPoolSize</strong></a></li>
<li><a href="#keepalivetime"><strong>keepAliveTime</strong></a></li>
<li><a href="#timeunit">TimeUnit</a></li>
<li><a href="#workqueue">workQueue</a></li>
<li><a href="#threadfactory">threadFactory</a></li>
<li><a href="#handler">handler</a></li>
</ul>
</li>
<li><a href="#%E6%A0%B8%E5%BF%83%E6%B5%81%E7%A8%8B">核心流程</a></li>
<li><a href="#%E5%85%B3%E9%97%AD">关闭</a></li>
<li><a href="#%E4%BA%94%E7%A7%8D%E7%B1%BB%E5%9E%8B-%E5%8C%BA%E5%88%AB-%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF">五种类型、区别、适用场景</a>
<ul>
<li><a href="#newcachedthreadpool">newCachedThreadPool：</a></li>
<li><a href="#newfixedthreadpool">newFixedThreadPool：</a></li>
<li><a href="#newsinglethreadexecutor">newSingleThreadExecutor:</a></li>
<li><a href="#newscheduledthreadpool">NewScheduledThreadPool:</a></li>
</ul>
</li>
</ul>

        </div>
        <script>
            function locateCatelogList() {
                /*获取文章目录集合,可通过:header过滤器*/
                var alis = $('.post-content :header');
                /*获取侧边栏目录列表集合**/
                var sidebar_alis = $('.markdownIt-TOC a');
                /*获取滚动条到顶部的距离*/
                var scroll_height = $(window).scrollTop();
                for (var i = 0; i < alis.length; i++) {
                    /*获取锚点集合中的元素分别到顶点的距离*/
                    var a_height = $(alis[i]).offset().top;
                    if (a_height < scroll_height) {
                        /*高亮显示*/
                        sidebar_alis.removeClass('on');
                        $(sidebar_alis[i]).addClass('on');
                    }
                }
            }
            $(function() {
                /*绑定滚动事件 */
                $(window).bind('scroll', locateCatelogList);
            });
        </script>
    </div>
    
                            

                </div>




            </div>


            <div class="site-footer">
  Powered by <a href="https://github.com/xzh20121116">xzh20121116</a> | 
  <a class="rss" href="https://xzh20121116.github.io/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>


    </div>
    <script>
        $('#sidebar').stickySidebar({
            topSpacing: 80,
            // bottomSpacing: 60
        });
    </script>
    
        
            <script>
    window.onload = function() {
        var gitalk = new Gitalk({
            clientID: '950ea46256189ac92219',
            clientSecret: '25c6a59041c1d4cd9ac1bd52c32a6b360b070699',
            repo: 'xzh20121116.github.io',
            owner: 'xzh20121116',
            admin: ['xzh20121116'],
            id: (location.pathname).substring(0, 49), // Ensure uniqueness and length less than 50
            distractionFreeMode: false // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    }
</script>
                

                    
                                
</body>

</html>